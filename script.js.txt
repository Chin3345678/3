const scenarios = [
  {
    text: "ðŸŒ… æ¸…æ™¨ï¼Œå®¶æ—æ—…è¡Œçš„ç¬¬ä¸€å¤©ï¼Œä½ è¢«é³¥é³´è²å–šé†’ã€‚ä½ æœƒæ€Žéº¼é–‹å§‹é€™æ®µæ—…ç¨‹ï¼Ÿ",
    options: [
      { text: "ðŸ“… ç¢ºèªè¡Œç¨‹ä¸¦æ•´ç†è£å‚™ã€‚", type: "INTJ" },
      { text: "ðŸ¥ æº–å‚™é©šå–œæ—©é¤çµ¦å®¶äººï¼", type: "ESFJ" },
      { text: "ðŸŽ¶ æ”¾éŸ³æ¨‚è®“æ—©æ™¨å……æ»¿æ´»åŠ›ï¼", type: "ENFP" },
      { text: "ðŸ›Œ å†è³´åºŠä¸€ä¸‹ï¼Œå……é£½ç²¾ç¥žå†å‡ºé–€ã€‚", type: "ISFJ" },
      { text: "ðŸ“‹ æª¢æŸ¥æ¯å€‹äººçš„è£å‚™å’Œå®‰å…¨ç‹€æ³ã€‚", type: "ESTJ" },
      { text: "ðŸ§¸ è·Ÿå­©å­çŽ©çŽ©éŠæˆ²å†å‡ºé–€ã€‚", type: "ISFP" }
    ]
  },
  {
    text: "ðŸš— é€”ä¸­ç¶“éŽé¢¨æ™¯å°è·¯ï¼Œä½ æœƒæ€Žéº¼åšï¼Ÿ",
    options: [
      { text: "ðŸš£ï¸ æŒ‰è¨ˆåŠƒå‰è¡Œã€‚", type: "ISTJ" },
      { text: "ðŸŒ¿ æŽ¢ç´¢å°è·¯æ‰¾æ–°é©šå–œã€‚", type: "ENFP" },
      { text: "ðŸ“· åœä¸‹ä¾†æ‹ç…§ç´€éŒ„ç¾Žæ™¯ã€‚", type: "ISFJ" },
      { text: "ðŸ—ºï¸ å»ºè­°æ”¹è®Šè·¯ç·šå°‹æ‰¾æ·å¾‘ã€‚", type: "INTJ" },
      { text: "ðŸ“Š è¨ˆç®—æ™‚é–“èˆ‡é¢¨éšªå¾Œåšå‡ºæ±ºç­–ã€‚", type: "ESTJ" },
      { text: "ðŸŽ¨ æ‰¾é¢¨æ™¯æœ€æ¼‚äº®çš„åœ°æ–¹ç•«ç•«ã€‚", type: "ISFP" }
    ]
  },
  {
    text: "ðŸ½ï¸ åˆé¤æ™‚é–“åˆ°äº†ï¼Œå¤§å®¶é¤“äº†ã€‚ä½ æœƒæ€Žéº¼å®‰æŽ’ï¼Ÿ",
    options: [
      { text: "ðŸ“ æ‰¾æœ€è¿‘çš„é¤å»³ï¼Œä¸æ‹–æ™‚é–“ã€‚", type: "ISTJ" },
      { text: "ðŸŽ‰ æ‰¾æœ‰è¶£çš„åœ¨åœ°å°åƒé«”é©—åœ°æ–¹æ–‡åŒ–ã€‚", type: "ENFP" },
      { text: "ðŸ’– é¸æ“‡å®¶äººå–œæ­¡çš„é¤å»³ï¼Œç…§é¡§å¤§å®¶éœ€æ±‚ã€‚", type: "ESFJ" },
      { text: "ðŸ—‘ï¸ çœ‹è©•åƒ¹èˆ‡æŽ¨è–¦ï¼Œç²¾æŒ‘ç²¾é¸ã€‚", type: "INTJ" },
      { text: "ðŸ—¾ æ ¹æ“šé ç®—èˆ‡åå¥½åšå‡ºæœ€ä½³é¸æ“‡ã€‚", type: "ESTJ" },
      { text: "ðŸ± è‡ªå·±æº–å‚™ä¾¿ç•¶ï¼Œåœ¨è‡ªç„¶ä¸­ç”¨é¤ã€‚", type: "ISFP" }
    ]
  },
  {
    text: "ðŸžï¸ ä¸‹åˆå®‰æŽ’æˆ¶å¤–æ´»å‹•ï¼Œé‡åˆ°çªå¦‚å…¶ä¾†çš„é›¨ã€‚ä½ çš„åæ‡‰æ˜¯ï¼Ÿ",
    options: [
      { text: "ðŸŒ‚ æº–å‚™é›¨å…·ç¹¼çºŒè¡Œç¨‹ã€‚", type: "ISFJ" },
      { text: "ðŸ’¡ é¦¬ä¸Šæ‰¾å®¤å…§æ´»å‹•æ›¿ä»£æ–¹æ¡ˆã€‚", type: "INTJ" },
      { text: "ðŸ¿ æè­°åŽ»çœ‹é›»å½±æˆ–é€›è¡—ã€‚", type: "ENFP" },
      { text: "ðŸ“ æª¢è¦–è¨ˆåŠƒï¼Œç¢ºä¿å¾ŒçºŒè¡Œç¨‹ä¸å—å½±éŸ¿ã€‚", type: "ISTJ" },
      { text: "ðŸš™ å¸¶å¤§å®¶å…ˆä¸Šè»Šä¼‘æ¯ä¸€ä¸‹ç­‰é›¨åœã€‚", type: "ESTJ" },
      { text: "â˜• æ‰¾é–“æœ‰æ°£æ°›çš„å’–å•¡åº—æ”¾é¬†èŠå¤©ã€‚", type: "ISFP" }
    ]
  },
  {
    text: "ðŸŒ™ å¤œæ™šçµæŸæ™‚ï¼Œä½ æœƒæ€Žéº¼ç¸½ç´„é€™è¸æ—…è¡Œï¼Ÿ",
    options: [
      { text: "ðŸ“– å¯«ä¸‹å›žæ†¶æ—¥è¨˜ï¼Œç´€éŒ„é»žæ»´ã€‚", type: "ISFJ" },
      { text: "ðŸ“· æ•´ç†ä»Šå¤©çš„ç…§ç‰‡èˆ‡å½±ç‰‡ã€‚", type: "ESFJ" },
      { text: "ðŸ» å’Œå®¶äººèŠèŠæœ€æœ‰è¶£çš„æ™‚åˆ»ã€‚", type: "ENFP" },
      { text: "ðŸ—‚ï¸ æª¢è¨Žè¡Œç¨‹ï¼Œæ€è€ƒä¸‹æ¬¡æ”¹é€²ç©ºé–“ã€‚", type: "INTJ" },
      { text: "ðŸ“Š æ•´ç†é ç®—èˆ‡èŠ±è²»ï¼Œç¢ºèªä¸€åˆ‡ç„¡èª¤ã€‚", type: "ESTJ" },
      { text: "ðŸ–Œï¸ ç•«ä¸‹ä¸€å¼µæ—…è¡Œé€Ÿå¯«ç•¶ç´€å¿µã€‚", type: "ISFP" }
    ]
  }
];

const characterProfiles = {
  ESFJ: {
    name: "è Ÿç­†å°æ–°-é‡ŽåŽŸå»£å¿— (ESFJ)",
    description: "ç†±å¿ƒåˆæœ‰è²¬ä»»æ„Ÿçš„ç¤¾äº¤é«˜æ‰‹ï¼Œä¸‹ç­å†ç´¯ä¹Ÿä¸å¿˜é€—å­©å­ç¬‘ï¼Œé›–ç„¶éž‹å­ä¸€è„«å…¨å®¶æ˜å€’ï¼Œä½†æ²’äººæ‡·ç–‘ä»–å°å®¶çš„æ„›æ˜¯æœ€æ¿ƒçš„ã€‚",
    image: "https://chin3345678.github.io/5/images/hiroshi.png"
  },
  INTJ: {
    name: "ååµæŽ¢æŸ¯å—-æ¯›åˆ©å°äº”éƒŽ (INTJ)",
    description: "å¤–è¡¨çœ‹èµ·ä¾†æ•£æ¼«ã€å…§å¿ƒå…¶å¯¦ç¸å¯†ï¼Œæ˜¯ç”¨é‚è¼¯æ€è€ƒæ’èµ·å®¶çš„ç¥žç§˜æ™ºå°‡ã€‚è¡Œå‹•ä½Žèª¿ï¼Œè…¦è¢‹é«˜é€Ÿé‹è½‰ï¼Œåªæ˜¯è¡Œå‹•åŠ›â€¦æœ‰æ™‚äº¤çµ¦æŸ¯å—ã€‚",
    image: "https://chin3345678.github.io/5/images/kogoro.png"
  },
  ISTJ: {
    name: "æ«»æ¡ƒå°ä¸¸å­-æ«»å»£å¿— (ISTJ)",
    description: "å¸¸å¸¸è² è²¬å®¶è£¡çš„ç¶“æ¿Ÿé–‹æ”¯ã€è¬›æ±‚ç§©åºï¼Œæœƒé—œå¿ƒéŒ¢èŠ±åˆ°å“ªè£¡ï¼Œè¡Œäº‹ä¿å®ˆåˆé‡è¦–è²¬ä»»ï¼Œå›žå®¶å¾Œçµ•ä¸é¦¬è™Žâ€”â€”å°¤å…¶æ˜¯å°å†°ç®±è£¡çš„å•¤é…’æ•¸é‡ã€‚",
    image: "https://chin3345678.github.io/5/images/sakura.png"
  },
  ENFP: {
    name: "ç«å½±å¿è€…-æ¼©æ¸¦é³´äºº (ENFP)",
    description: "ç†±è¡€æ¨‚è§€ã€æ„ŸæŸ“åŠ›åè¶³ï¼Œæ˜¯ç”¨å¤¢æƒ³å¸¶å‹•å®¶çš„è¡Œå‹•æ´¾çˆ¸çˆ¸ã€‚é›–ç„¶ä¸å¤ªæ“…é•·ç´°ç¯€ï¼Œä½†å­©å­çŸ¥é“ä»–æ°¸é ç«™åœ¨è‡ªå·±é€™é‚Šã€‚",
    image: "https://chin3345678.github.io/5/images/naruto.png"
  },
  ISFJ: {
    name: "é–“è«œå®¶å®¶é…’-é»ƒæ˜ ä½›å‚‘ (ISFJ)",
    description: "ç´°å¿ƒç©©é‡ã€é»˜é»˜ä»˜å‡ºï¼Œæ˜¯ç”¨è¡Œå‹•å®ˆè­·å®¶äººå®‰å…¨æ„Ÿçš„è·äººåž‹çˆ¸çˆ¸ã€‚å¤–è¡¨å†·éœï¼Œå…§å¿ƒæ»¿æ»¿éƒ½æ˜¯å°å®¶çš„æº«æŸ”èˆ‡å …æŒã€‚",
    image: "https://chin3345678.github.io/5/images/loidy.png"
  },
  ESTJ: {
    name: "æµ·ç¶¿å¯¶å¯¶-èŸ¹è€é–¥ (ESTJ)",
    description: "è¬›æ±‚è¦å‰‡ã€æ•ˆçŽ‡æ»¿åˆ†ï¼Œæ˜¯èƒ½æŠŠå®¶åº­ç¶“ç‡Ÿå¾—åƒå…¬å¸ä¸€æ¨£ç©©çš„è¡Œå‹•æ´¾çˆ¸çˆ¸ã€‚æœ€æ„›çš„ä¸‰æ¨£æ±è¥¿ï¼šéŒ¢ã€éŒ¢ã€é‚„æœ‰éŒ¢â€”â€”ä½†å®¶äººæ°¸é æ˜¯ä»–æœ€ä¿å€¼çš„æŠ•è³‡ã€‚",
    image: "https://chin3345678.github.io/5/images/krabs.png"
  },
  ISFP: {
    name: "ä½©ä½©è±¬-è±¬çˆ¸çˆ¸ (ISFP)",
    description: "æº«æŸ”å–„æ„Ÿã€æ…¢æ¢æ–¯ç†ï¼Œæ˜¯ç”¨é™ªä¼´èªªæ„›çš„è—è¡“åž‹çˆ¸çˆ¸ã€‚ä»–çš„ä¸–ç•Œæ²’æœ‰é«˜è²æ–¥è²¬ï¼Œåªæœ‰éœéœååœ¨ä½ èº«é‚Šçš„æº«æš–ã€‚",
    image: "https://chin3345678.github.io/5/images/daddypig.png"
  }
};

let currentScenario = 0;
const chosenTypes = [];

function loadScenario(index) {
  const scenario = scenarios[index];
  $("#scenarioText").text(scenario.text);
  const optionsDiv = $("#options").empty();

  scenario.options.forEach((option) => {
    $("<button>")
      .addClass("option")
      .text(option.text)
      .on("click", function () {
        $(".option").removeClass("selected");
        $(this).addClass("selected");
        chosenTypes[index] = option.type;
        $("#nextButton").prop("disabled", false);
        $("#finishButton").toggle(index === scenarios.length - 1);
        if (index === scenarios.length - 1) {
          $("#nextButton").prop("disabled", true);
        }
      })
      .appendTo(optionsDiv);
  });

  $("#nextButton")
    .toggle(index < scenarios.length - 1)
    .prop("disabled", true);
  $("#finishButton")
    .toggle(index === scenarios.length - 1)
    .hide();
}

function showResult() {
  const resultType = mostFrequentType(chosenTypes);
  const profile = characterProfiles[resultType];

  $("#quiz").hide();
  $("#resultTitle").text(`ä½ çš„äººæ ¼é¡žåž‹æ˜¯ï¼š${profile.name}`);
  $("#characterImage").attr("src", profile.image);
  $("#resultDescription").text(profile.description);
  $("#result").show();

  // åˆ†äº«å¡ç”¨çš„å…§å®¹
  $("#shareImage").attr("src", profile.image);
  $("#shareText").text(`æˆ‘æ˜¯ ${profile.name}ï¼`);

  // Line åˆ†äº«
  $("#lineShareButton").attr(
    "href",
    `https://line.me/R/msg/text/?${encodeURIComponent("æˆ‘åœ¨ã€Œè²æ¯”è‹±æ–‡-å‹•æ¼«çˆ¸çˆ¸ MBTI å¿ƒç†æ¸¬é©—ã€ä¸­æ˜¯ " + profile.name + "ï¼ä½ ä¹Ÿä¾†æ¸¬çœ‹çœ‹å§!\nhttps://chin3345678.github.io/2/")}`
  );
}

function mostFrequentType(types) {
  const frequency = types.reduce(
    (acc, type) => ((acc[type] = (acc[type] || 0) + 1), acc),
    {}
  );
  return Object.keys(frequency).reduce((a, b) =>
    frequency[a] >= frequency[b] ? a : b
  );
}

$(document).ready(function () {
  $("#startButton").on("click", function () {
    $("#intro").hide();
    $("#quiz").show();
    loadScenario(currentScenario);
  });

  $("#nextButton").on("click", function () {
    if (currentScenario < scenarios.length - 1) {
      currentScenario++;
      loadScenario(currentScenario);
    }
  });

  $("#finishButton").on("click", function () {
    if (chosenTypes[currentScenario]) {
      showResult();
    }
  });

  $("#restartButton").on("click", function () {
    currentScenario = 0;
    chosenTypes.length = 0;
    $("#result").hide();
    $("#intro").show();
  });
});
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
  document.getElementById("saveButton").addEventListener("click", function () {
    html2canvas(document.getElementById("shareCard")).then(function (canvas) {
      const link = document.createElement("a");
      link.download = "result_card.png";
      link.href = canvas.toDataURL();
      link.click();
    });
  });
</script>
